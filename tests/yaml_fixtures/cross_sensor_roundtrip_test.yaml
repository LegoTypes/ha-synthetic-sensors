version: '1.0'
sensors:
  # Sensor A: Base power sensor with self-references
  base_power_sensor:
    entity_id: sensor.span_panel_instantaneous_power
    formula: state * 1.1  # Self-reference using state token
    variables:
      scale_factor: 0.95
    attributes:
      daily_power:
        formula: state * 24  # Self-reference in attribute
        metadata:
          unit_of_measurement: W
      efficiency:
        formula: state / state * 100  # Self-reference using state token
        metadata:
          unit_of_measurement: "%"

  # Sensor B: References Sensor A (cross-sensor reference)
  efficiency_calc:
    entity_id: sensor.span_panel_instantaneous_power  # Will cause collision
    formula: base_power_sensor * 0.85  # Cross-sensor reference to Sensor A
    variables:
      local_factor: 0.9
    attributes:
      combined_power:
        formula: state + base_power_sensor  # Cross-sensor reference in attribute
        metadata:
          unit_of_measurement: W
      ratio:
        formula: state / base_power_sensor  # Cross-sensor reference in attribute
        metadata:
          unit_of_measurement: "ratio"