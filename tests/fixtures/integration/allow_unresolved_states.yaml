version: "1.0"

global_settings:
  device_identifier: "test_allow_unresolved_states"
  variables:
    grace_minutes: 15
  metadata:
    attribution: "Allow unresolved states test"

sensors:
  allow_unresolved_sensor:
    name: "Allow Unresolved States Sensor"
    entity_id: "sensor.allow_unresolved_backing"
    formula: "state"
    alternate_states:
      UNAVAILABLE:
        formula: "state if within_grace else 'fallback'"
      UNKNOWN:
        formula: "state if within_grace else 'fallback'"
    variables:
      within_grace:
        formula: "minutes_between(metadata(state, 'last_changed'), now()) < grace_minutes"
        alternate_states:
          UNAVAILABLE: false
          UNKNOWN: false
        allow_unresolved_states: true  # Allow alternate states to proceed into formula evaluation
    metadata:
      unit_of_measurement: "W"
      device_class: "power"


