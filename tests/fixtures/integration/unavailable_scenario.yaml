version: "1.0"

global_settings:
  device_identifier: "test_unavailable_scenario"
  variables:
    energy_grace_period_minutes: 15
  metadata:
    attribution: "Unavailable scenario test"

sensors:
  test_unavailable_sensor:
    name: "Unavailable Test Sensor"
    entity_id: "sensor.test_unavailable_entity"
    formula: "state"
    alternate_states:
      UNAVAILABLE:
        formula: "state if within_grace else 'fallback'"
      UNKNOWN:
        formula: "state if within_grace else 'fallback'"
      NONE:
        formula: "'fallback'"
    variables:
      within_grace:
        formula: "minutes_between(metadata(state, 'last_changed'), now()) < energy_grace_period_minutes"
        alternate_states:
          UNAVAILABLE: false
          UNKNOWN: false
    metadata:
      unit_of_measurement: "W"
      device_class: "power"


