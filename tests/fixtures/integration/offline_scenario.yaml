version: "1.0"

global_settings:
  device_identifier: "test_offline_scenario"
  variables:
    energy_grace_period_minutes: 15
  metadata:
    attribution: "Offline scenario test"

sensors:
  offline_sensor:
    name: "Offline Sensor"
    entity_id: "sensor.offline_backing"
    formula: "state"
    alternate_states:
      UNAVAILABLE:
        formula: "state if within_grace else 'unknown'"
      UNKNOWN:
        formula: "state if within_grace else 'unknown'"
    variables:
      within_grace:
        formula: "minutes_between(metadata(state, 'last_changed'), now()) < energy_grace_period_minutes"
        alternate_states:
          UNAVAILABLE: false
          UNKNOWN: false
    metadata:
      unit_of_measurement: "W"
      device_class: "power"


